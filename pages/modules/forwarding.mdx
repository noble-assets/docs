# `x/forwarding` Module

## Background

When [Inter-Blockchain Communication][ibc] (**IBC**) was introduced into Cosmos, it set the standard on how app-chains communicate with each other. IBC is primarily used to facilitate asset transfers between app-chains via ICS-20, the token transfer standard.

However, IBC introduced an UX issue when transferring between multiple networks at once. In order to take your assets from *Chain A* (e.g. Osmosis), through *Chain B* (e.g. Noble), to *Chain C* (e.g. dYdX), this would require 2 separate transactions signed by the user (one on *Chain A* and another on *Chain B*). To address this issue, [Strangelove Labs][strangelove] team developed [Packet Forward Middleware][pfm] (**PFM**), which allows users to utilise an "intents" like system that only requires them to sign a single transaction to transfer between chains.

However, this only solves the issue when a user is directly interacting with IBC. With Noble, users can use tools like [Circle Mint][mint] and [CCTP][cctp] to receive and transfer assets seamlessly on multiple networks.

## Solution

The `x/forwarding` module works by allowing the permissionless creation of a new account type using the `x/auth` module. This new account type, `ForwardingAccount`, adds two fields to the `BaseAccount`: the *channel id* of an IBC enabled chain connected to Noble, and the *recipient* address on that connected chain.

### Example

```json
{
  "account": {
    "@type": "/noble.forwarding.v1.ForwardingAccount",
    "base_account": {
      "address": "noble1...",
      "pub_key": null,
      "account_number": "0",
      "sequence": "0"
    },
    "channel": "channel-22",
    "recipient": "osmo1...",
    "created_at": "5797500"
  }
}
```

This account has the address `noble1...`, which natively receives $USDC and other tokens. However, the `channel` and `recepient` fields tell the `x/forwarding` module how to automatically forward any tokens that this account receives. The *fallback* fields tells the module where to send tokens when clearing the account.

## Usage

There are two ways that someone can register a forwarding account on Noble.

### 1. Directly on Noble

You can register a forwarding account by submitting a transaction directly to Noble. This can be done via our CLI:

```shell
nobled tx forwarding register-account [channel] [recipient]
```

#### Fields

*channel*: specifies the IBC channel through which tokens are forwarded

*recipient*: the address that receives the forwarded tokens

### 2. Via an IBC Packet

You can register a forwarding account by including the following data in the memo field of an IBC packet sent to Noble.

```json
{
  "noble": {
    "forwarding": {
      "recipient": "cosmos1..."
      // "channel": "channel-0"
    }
  }
}
```

By default, the *channel* is implied from the incoming IBC packet; however, you can manually override this by additionally specifying in the `channel` field.

#### Fields

*channel*: specifies the IBC channel through which tokens are forwarded

*recipient*: the address that receives the forwarded tokens

## Clearing a Forwarding Account

Clearing a forwarding account should be performed when tokens are stuck in the account due to an issue with the respective channel. If you need to clear a forwarding account, this can be done using the CLI:

```json
nobled tx forwarding clear-account [address] --from [signer] --fallback.
```
This will clear the forwarding account, sending all tokens in the account to the *fallback* address. If the `--fallback` flag is not included, it will instead attempt to forward the tokens to the destination address.

#### Fields

*address*: the address of the forwarding account
*signer*: the address that registered the forwarding account

## Querying Forwarding Information

The x/forwarding module provides several queries that allow you to retrieve information about forwarding accounts, allowed denominations, and overall statistics.

### Get Allowed Denominations

Get the list of denominations currently allowed for forwarding:

```json
nobled query forwarding denoms
```

### Get Forwarding Account Details

Get the details of a specific forwarding account. The response contains the associated channel and recipient:

```json
nobled query forwarding address [channel] [address]
```

#### Fields

*channel*: specifies the IBC channel through which tokens are forwarded

*address*: the address of the forwarding account

### Querying Forwarding Statistics

Get an overview of forwarding statistics. The response contains the number of accounts and the amount forwarded:

```json
nobled query forwarding stats
```

### Querying Statistics by Channel

Retrieve forwarding statistics specific to a particular channel. The response contains the number of accounts and the amount forwarded, specific to that channel.

```json
nobled query forwarding stats [channel]
```

#### Fields

*channel*: specifies the IBC channel to get stats of

[cctp]: https://www.circle.com/en/cross-chain-transfer-protocol
[channel]: https://github.com/cosmos/chain-registry/blob/master/testnets/_IBC/nobletestnet-osmosistestnet.json
[ibc]: https://www.ibcprotocol.dev/
[mint]: https://www.circle.com/en/circle-mint
[pfm]: https://github.com/cosmos/ibc-apps/tree/main/middleware/packet-forward-middleware
[strangelove]: https://strange.love/
