# `x/forwarding` Module

## Background

When [Inter-Blockchain Communication][ibc] (**IBC**) was introduced into Cosmos, it set the standard on how app-chains communicate with each other. IBC is primarily used to facilitate asset transfers between app-chains via ICS-20, the token transfer standard.

However, IBC introduced an UX issue when transferring between multiple networks at once. In order to take your assets from *Chain A* (e.g. Osmosis), through *Chain B* (e.g. Noble), to *Chain C* (e.g. dYdX), this would require 2 separate transactions signed by the user (one on *Chain A* and another on *Chain B*). To address this issue, the Noble team designed a forwarding system for all middleware and protocols integrated with Noble using [Packet Forward Middleware (PFM)][pfm]. Now, with Noble's issuance of native $USDC, users can use tools like [Circle Mint][mint] and [CCTP][cctp] to receive and transfer assets seamlessly on multiple networks.

## Solution

The `x/forwarding` module works by allowing the permissionless creation of a new account type using the `x/auth` module. This new account type, `ForwardingAccount`, adds two fields to the `BaseAccount`: the *channel id* of an IBC enabled chain connected to Noble, and the *recipient* address on that connected chain.

### Example

```json
{
    "account": {
        "@type": "/noble.forwarding.v1.ForwardingAccount",
        "base_account": {
            "address": "noble1...",
            "pub_key": null,
            "account_number": "0",
            "sequence": "0"
        },
        "channel": "channel-22",
        "recipient": "osmo1...",
        "created_at": "5513018"
    }
}
```

 This account has the address [`noble1...`][account-noble], which natively receives $USDC and other tokens. However, the `channel` and `recepient` fields tell the `x/forwarding` module how to automatically forward any tokens that this account receives.

## Usage

There are three ways that someone can register a forwarding account on Noble.

### 1. Directly on Noble

You can register a forwarding account by submitting a transaction directly to Noble. This can be done via our CLI:

```shell
nobled tx forwarding register-account [channel] [recipient]
```

### 2. Via an ICS-20 Transfer

You can register a forwarding account by sending an ICS-20 transfer packet to Noble. The packet memo should be formatted as follows:

```json
{
    "noble": {
        "forwarding": {
            "recipient": "cosmos1..."
        }
    }
}
```

By default, the *channel* of the forwarding account is set from the channel used to create the account; however, you can manually override this by additionally specifying in the `channel` field.

### 3. Via an IBC Packet

You can register a forwarding account by including the following data in the memo field of an IBC packet sent to Noble.

```json
{
  "noble": {
    "forwarding": {
      "recipient": "cosmos1..."
    }
  }
}
```

By default, the *channel* is implied from the incoming IBC packet; however, you can manually override this by additionally specifying in the `channel` field.

[account]: https://rest.testcosmos.directory/nobletestnet/cosmos/auth/v1beta1/accounts/noble1ff834feyg9advguuqkqzfeh8j7rckx5rq7fwl6
[account-noble]: https://www.mintscan.io/noble-testnet/address/noble1ff834feyg9advguuqkqzfeh8j7rckx5rq7fwl6
[account-osmosis]: https://www.mintscan.io/osmosis-testnet/address/osmo1ujcqk24anr83ypmezn4t8l9u0cdjjsklnwrgr9
[cctp]: https://www.circle.com/en/cross-chain-transfer-protocol
[channel]: https://github.com/cosmos/chain-registry/blob/master/testnets/_IBC/nobletestnet-osmosistestnet.json
[ibc]: https://www.ibcprotocol.dev/
[mint]: https://www.circle.com/en/circle-mint
[pfm]: https://github.com/cosmos/ibc-apps/tree/main/middleware/packet-forward-middleware
[strangelove]: https://strange.love/
