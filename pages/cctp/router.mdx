# CCTP Router

import { Callout } from "nextra/components";

## Deposit For Burn

Similar to Circle's [original function][Original Deposit For Burn], our wrapper includes four new function parameters, which are highlighted below.

```solidity {2,3,4,8}
function depositForBurn(
    uint64 channel,
    bytes32 destinationBech32Prefix,
    bytes32 destinationRecipient,
    uint256 amount,
    bytes32 mintRecipient,
    address burnToken,
    bytes calldata memo
) external returns (uint64 nonce)
```

Let's expand on what each of these parameters means:

### `channel`

This parameter defines the [IBC Channel] to use when forwarding your newly minted $USDC.

You can find a list of trusted channels [here][Mainnet Relayers] (for testnet, [here][Testnet Relayers]).

<Callout>
  In the case of the dYdX Testnet, this would be [`channel-16`][Testnet dYdX Channel], so **`16`** would be supplied as an argument.

    Note that this needs to be supplied as hex (**`0x10`**).

</Callout>

### `destinationBech32Prefix`

This parameter defines the [Bech32 Prefix] used to encode addresses on the chain funds are being forwarded to.

In order to align ourselves with the CCTP standard, users are required to encode this as a padded `bytes32` input. Please see the [Encoding](#encoding) section to learn how to do this.

<Callout>
    In the case of the dYdX Testnet, **`dydx`** would be supplied as an argument.

    Note that this needs to be supplied as hex (**`0x0000000000000000000000000000000000000000000000000000000064796478`**).

</Callout>

### `destinationRecipient`

This parameter defines the address you wish to forward the new minted $USDC to.

In order to align ourselves with the CCTP standard, users are required to encode this as a padded `bytes32` input. Please see the [Encoding](#encoding) section to learn how to do this.

### `memo`

Recently [introduced][IBC Memo Field] to the IBC Transfer specification, `memo` is an optional field that allows users to specify arbitrary data to be included with their transfer. This can be as simple as an informational note, or as complex as specifying programmatic actions through [IBC Hooks].

## Encoding

Below you will find a simple script that pads & hex encodes both the destination bech32 prefix and recipient.

The highlighted lines indicate inputs you can change to your specific case.

```go copy {12-15}
package main

import (
	"bytes"
	"fmt"

	sdk "github.com/cosmos/cosmos-sdk/types"
	"github.com/ethereum/go-ethereum/common"
)

func main() {
	// -----
	prefix := "dydx"
	address := "dydx1tq944l2tgxugwvu74yke37yt7pa27p84myc2sd"
	// -----

	rawPrefix := []byte(prefix)
	encodedPrefix := Encode(rawPrefix)
	decodedPrefix := Decode(encodedPrefix)

	rawAddress, _ := sdk.GetFromBech32(address, prefix)
	encodedAddress := Encode(rawAddress)
	decodedAddress := Decode(encodedAddress)

	fmt.Println("ENCODED PREFIX: ", encodedPrefix)
	fmt.Println("DECODED PREFIX: ", string(decodedPrefix))
	fmt.Println()
	fmt.Println("ENCODED ADDRESS:", encodedAddress)
	fmt.Println("DECODED ADDRESS:", sdk.MustBech32ifyAddressBytes(
		string(decodedPrefix), decodedAddress,
	))
}

func Encode(bz []byte) (encoded string) {
	padded := make([]byte, 32)
	copy(padded[32-len(bz):], bz)

	return "0x" + common.Bytes2Hex(padded)
}

func Decode(encoded string) (bz []byte) {
	padded := common.FromHex(encoded)
	return bytes.TrimLeft(padded, string(byte(0)))
}
```

The output of the exact script above is:

```
ENCODED PREFIX:  0x0000000000000000000000000000000000000000000000000000000064796478
DECODED PREFIX:  dydx

ENCODED ADDRESS: 0x000000000000000000000000580b5afd4b41b887339ea92d98f88bf07aaf04f5
DECODED ADDRESS: dydx1tq944l2tgxugwvu74yke37yt7pa27p84myc2sd
```

[Bech32 Prefix]: https://docs.cosmos.network/v0.50/spec/addresses/bech32
[IBC Channel]: https://ibc.cosmos.network/main/ibc/overview.html#channels
[IBC Hooks]: https://github.com/osmosis-labs/osmosis/tree/main/x/ibc-hooks#readme
[IBC Memo Field]: https://medium.com/the-interchain-foundation/moving-beyond-simple-token-transfers-d42b2b1dc29b
[Mainnet Relayers]: https://www.mintscan.io/noble/relayers
[Original Deposit For Burn]: https://github.com/circlefin/evm-cctp-contracts/blob/1ddc5057e2a686194d481d04239387cf095ec760/src/TokenMessenger.sol#L169-L174
[Testnet Relayers]: https://testnet.mintscan.io/noble-testnet/relayers
[Testnet dYdX Channel]: https://testnet.mintscan.io/noble-testnet/relayers/channel-16/dydx-testnet/channel-0
